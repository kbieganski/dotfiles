#!/bin/env bash

if [ $# -eq 0 ]; then
    echo "error: no operation specified"
    exit 1
elif [ $# -gt 1 ]; then
    echo "Only one argument is supported"
    exit 1
fi

case "$1" in
-S | --sync)
    pacman_query="-Ssq"
    pacman_preview="-Si"
    pacman_op="-S"
    ;;
-R | --remove)
    pacman_query="-Qq | rg"
    pacman_preview="-Qi"
    pacman_op="-R"
    ;;
*)
    echo "Unsupported argument: $1"
    return 1
    ;;
esac

reload="reload:pacman $pacman_query {q} || :"
fzf --disabled --ansi --multi \
    --bind "start:$reload" --bind "change:${reload}:sleep 1" \
    --preview "pacman $pacman_preview {}" \
    --preview-window '<80(up)' \
    --bind "enter:become(pacman $pacman_op --noconfirm {})"
