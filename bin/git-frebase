#!/bin/env bash

if ! git status &>/dev/null; then
    echo "Not in a git repository"
    exit 1
fi
args=
branches=true
commits=true
while [ $# -gt 0 ]; do
    case "$1" in
    -c | --commits)
        branches=false
        ;;
    -b | --branches)
        commits=false
        ;;
    *)
        args+="$1"
        ;;
    esac
    shift
done
refs=
if $commits; then
    refs+=$(git log --format=reference | tac)
fi
if $branches; then
    refs+=$(git branch --all --format="%(refname:short)")
fi
ref=$(printf '%s\n' "${refs[@]}" | fzf --tac | cut -d' ' -f1)
[ -n "$ref" ] && git rebase ${args[@]} $ref
